INTERNSHIPS_API_CONSUMER_PROJECT ?= internships-api-consumer-project
INTERNSHIPS_API_CONSUMER_IMAGE_NAME ?= internships-api-consumer
INTERNSHIPS_API_CONSUMER_IMAGE_VERSION ?= 0.0.1
INTERNSHIPS_API_CONSUMER_KEY ?= 873497b1-ynbu-8dvs-8876-879th56e7869
INTERNSHIPS_MESSAGE_BROKER_USERNAME ?= internshipsbackendmessagebroker
INTERNSHIPS_MESSAGE_BROKER_PASSWORD ?= internshipsbackendmessagebrokerpwd
INTERNSHIPS_MESSAGE_BROKER_HOST ?= message-broker
INTERNSHIPS_MESSAGE_BROKER_PORT ?= 5672
INTERNSHIPS_API_CONSUMER_PROXY_NETWORK ?= "internships-network"
INTERNSHIPS_API_URL ?= http://internships-api:8008

.PHONY: build
build:
	docker build -t $(INTERNSHIPS_API_CONSUMER_IMAGE_NAME):$(INTERNSHIPS_API_CONSUMER_IMAGE_VERSION) -f Dockerfile .

.PHONY: run
run:
	- docker network create $(INTERNSHIPS_API_CONSUMER_PROXY_NETWORK)
	sleep 1
	APP_API_CONSUMER_IMAGE_VERSION=$(INTERNSHIPS_API_CONSUMER_IMAGE_VERSION) \
    APP_API_CONSUMER_IMAGE_NAME=$(INTERNSHIPS_API_CONSUMER_IMAGE_NAME) \
    APP_PROXY_NETWORK=$(INTERNSHIPS_API_CONSUMER_PROXY_NETWORK) \
    APP_MESSAGE_BROKER_USERNAME=$(INTERNSHIPS_MESSAGE_BROKER_USERNAME) \
    APP_MESSAGE_BROKER_PASSWORD=$(INTERNSHIPS_MESSAGE_BROKER_PASSWORD) \
    APP_MESSAGE_BROKER_HOST=$(INTERNSHIPS_MESSAGE_BROKER_HOST) \
    APP_MESSAGE_BROKER_PORT=$(INTERNSHIPS_MESSAGE_BROKER_PORT) \
    APP_API_CONSUMER_KEY=$(INTERNSHIPS_API_CONSUMER_KEY) \
    APP_API_URL=$(INTERNSHIPS_API_URL) \
	docker-compose -p $(INTERNSHIPS_API_CONSUMER_PROJECT) -f docker-compose.yaml up -d
